'use strict';(function(d){function z(a,b){var e="",f="",p=a.find("input"),h=c.session.getTextRange(c.getSelectionRange());0<h.trim().length&&p.eq(0).val(h);a.find(".modal-footer button.btn-success").on("click.codeparlMarkdown",function(){e=p.eq(0).val();f=p.eq(1).val();0<f.length&&0<e.length?(a.modal("hide"),b?l.insertSnippet(c,"["+e+"]("+f+")"):l.insertSnippet(c,"!["+e+"]("+f+")")):A(a)})}function m(a,b){var e=c.session.getTextRange(c.getSelectionRange())||"";e.trim();var f=c.find(b,{wrap:!0,caseSensitive:!0,
wholeWord:!0,regExp:!1,preventScroll:!0});"rule"===b?(c.insert(a),c.navigateLineEnd()):(null!==f?c.session.replace(f,b):0===c.getCursorPosition().column?"``"===a?c.insert("`"+b+"`"):c.insert(a+b+""):0<e.length?(f=c.getSelectionRange(),"``"===a?(c.insert("`"+e+"`"),c.session.replace(f,"`"+e+"`")):c.session.replace(f,a+e)):(c.navigateLineStart(),"``"===a?c.insert("`"+b+"`"):c.insert(a+b+" "),c.navigateLineEnd()),0===e.trim().length&&c.find(b),c.focus())}function B(a){"function"!==d.type(d().modal)&&
d.error("bootstrap.min.js is required for this plugin");var b='<div class="modal fade " data-backdrop="false" id="codeparlMarkdown-modal"  tabindex="-1" role="dialog"><div class="modal-dialog   " role="document"><div class="modal-content"><div class="modal-header "><h4 class="modal-title text-capitalize "> '+(a.title+"</h4>");b=d(b+' <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"></div><div class="modal-footer mx-auto text-center w-100"><button class="btn btn-sm btn-success">OK</button><button data-dismiss="modal" class="btn btn-sm btn-danger">cancel</button></div> </div></div> </div>').on("hidden.bs.modal",
function(){d(this).remove()});b.find(".modal-body").html(a.body);E(b);return b}function E(a){a.on("click.codeparlMarkdown",function(b){d(b.target).is(".modal-dialog *")||A(a)})}function C(a,b){a=a?a:"Text";b=b?b:"URL";var e=d("<input>").attr({type:"text",placeholder:"Enter "+a}).prop("required",!0).addClass("form-control form-control-sm");e=d("<label>").addClass("w-100").text(a+":").append(e);a=d("<input>").attr({type:b,placeholder:"Enter "+b}).prop("required",!0).addClass("form-control form-control-sm");
a=d("<label>").addClass("w-100").text(b+":").append(a);return d("<div>").append(e).append(a)}function D(a,b){if(a)q.show(),n.hide(),d(".cpme-btn-normal").prop("disabled",!1).removeClass("disabled");else{q.hide();n.show();a=c.session.getValue();a=t(a);var e=u.makeHtml(a);g.onPreview(v(e),a);n.html(v(e));d(".cpme-btn-normal").prop("disabled",!0).addClass("disabled")}b.addClass("active");b.siblings("button").removeClass("active")}function F(a){a.on("change.codeparlMarkdown",function(){g.onFileBrowse(a,
c)})}function v(a){if(!g.allowScript)return a.replace("<script>","&lt;script&gt;")}function A(a){a.find(".modal-content").addClass(" animated fast headShake");setTimeout(function(){a.find(".modal-content").removeClass("animated fast headShake")},1E3)}function G(){k.find(".cpme-toolbar .cpme-btn").each(function(){d(this).on("click.codeparlMarkdown",function(a){a.preventDefault();a=d(this);var b=a.data("action");d("[data-original-title]").tooltip("hide");switch(b){case "help":d(".cpme-help-bar").slideToggle("fast");
break;case "preview":D(!1,a);break;case "edit":D(!0,a);break;case "browse":a=a.next(".cpme-file-browser");F(a);a.trigger("click.codeparlMarkdown");break;case "fullscreen":d("body").toggleClass("cpme-fullscreen");k.toggleClass("fullscreen");a.find("i").toggleClass("fa-expand fa-compress");a.find("i").hasClass("fa-expand")?a.attr("data-original-title","Fullscreen"):a.attr("data-original-title","Restore");break;case "h1":m("# ","type your heading here");break;case "h2":m("## ","type your heading here");
break;case "ul":m("* ","type your item here");break;case "ol":m("1. ","type your item here");break;case "rule":m("----------","rule");break;case "block":m("> ","type here");break;case "code":m("``","enter code here");break;case "bold":c.execCommand("bold");break;case "italic":c.execCommand("italic");break;case "link":c.execCommand("link");break;case "image":a=B({title:"Enter Image URL",body:C("Alt Text")}).modal("show"),z(a,!1)}})})}function H(){var a=d("<div>").addClass("cpme-toolbar border-bottom p-1 ").css({backgroundColor:g.toolbar.bg});
for(const p in g.toolbar.buttonGroups){var b=g.toolbar.buttonGroups[p];var e=a;e=d("<div>").addClass("btn-group cpme-btn-group   mr-1").appendTo(e);for(const h in b)if(r.hasOwnProperty(h)){var f=d("<button>").addClass("btn btn-sm  cpme-btn").attr({"data-action":r[h].action,type:"button"}).attr("title",r[h].tooltip);if(null===b[h].match(/^(fa\-.+?)$/))f.text(b[h]);else{if(!1===g.fullscreen&&"btnFullscreen"===h)continue;f.html(d("<i>").addClass("fa "+b[h]))}e.append(f);"btnHelp"===h&&(g.help.show?e.addClass("cpme-md-help float-right  "):
e.remove());"btnRule"===h&&(f.html(d("<span>").addClass("cpme-rule")),f.addClass("cpme-rule-btn"));"btnEdit"===h&&(e.addClass("float-right"),f.addClass("active"));-1!==d.inArray(h,["btnEdit","btnPreview","btnHelp"])?"btnHelp"!==h&&f.append(d("<span>").text(r[h].tooltip)):f.addClass("cpme-btn-normal");"btnFullscreen"===h&&f.removeClass("cpme-btn-normal");"btnbrowse"===h&&d("<input>").attr({type:"file",accept:".md, .markdown"}).addClass("cpme-file-browser ").hide().insertAfter(f);"function"===typeof d().tooltip&&
f.tooltip()}}return a}function I(){var a=d("<div>");a.addClass("cpme-help-bar  w-100   mx-auto py-0 ");for(var b in w)d("<button>").attr({type:"button","data-key":b}).addClass("btn btn-sm btn-default cpme-help-btn shadow-none ").text(w[b].label).appendTo(a).on("click.codeparlMarkdown",function(){d(this).siblings(".cpme-help-btn").removeClass("cpmd-yellow");var e=d(".cpme-help-bar-info");e.css({top:a.height(),height:g.editor.editorHeight});e.html(d("<p>").addClass("p-4 mx-auto ").html(w[d(this).data("key")].help));
e.attr("data-key",d(this).data("key"));e.is(":hidden")&&e.slideDown("fast");d(this).hasClass("cpmd-yellow")&&e.slideUp("fast");d(this).toggleClass("cpmd-yellow")});d("<div>").addClass("cpme-help-bar-info  w-100   mx-auto py-0 ").appendTo(a).hide();d("<a>").attr({href:g.help.link.url,target:"_blank"}).text(g.help.link.text).addClass("btn btn-link cpme-help-link float-right").appendTo(a);return a}function t(a){var b=a.match(J);if(!b||null===b)return a;if(0<b.length)for(let f=0;f<b.length;f++){var e=
b[f];-1==e.search(/https?/)&&(e="http://"+e);a=a.replace(b[f],"["+e+"]("+e+")")}return a}function K(){c=ace.edit(q.get(0));c.setTheme("ace/theme/"+g.editor.theme);c.getSession().setMode("ace/mode/markdown");c.getSession().setUseWrapMode(!0);c.getSession().setUseSoftTabs(g.editor.softTabs);c.setOptions({fontSize:g.editor.fontSize,showGutter:g.editor.showGutter});ace.config.loadModule("ace/ext/language_tools",function(){l=ace.require("ace/snippets").snippetManager;c.commands.addCommand(x.bold);c.commands.addCommand(x.italic);
c.commands.addCommand(x.link)})}var c=null,J=/((https?:\/\/|ftp:\/\/|www\.|[^\s:=]+@www\.).*?[a-z_\/0-9\-#=&])(?=(\.|,|;|\?|!)?("|'|\u00ab|\u00bb|\[|\s|\r|\n|$))/ig,l=null,k=null,q,n,g=null,u=new showdown.Converter,r={btnHeader1:{tooltip:"Heading 1 <h1>",action:"h1"},btnHeader2:{tooltip:"Heading 2 <h2>",action:"h2"},btnBold:{tooltip:"Strong <strong> ",action:"bold"},btnItalic:{tooltip:"Empasise <em>",action:"italic"},btnbrowse:{tooltip:"Open a markdown file",action:"browse"},btnCode:{tooltip:"Code Sample <pre><code>",
action:"code"},btnBlock:{tooltip:"Blockquote <blockquote>",action:"block"},btnList:{tooltip:"Bulleted list <ul>",action:"ul"},btnOrderedList:{tooltip:"Numbered list <ol>",action:"ol"},btnRule:{tooltip:"Horizontal rule <hr>",action:"rule"},btnLink:{tooltip:"Hyperlink <a>",action:"link"},btnImage:{tooltip:"Insert image <img>",action:"image"},btnEdit:{tooltip:"Edit",action:"edit"},btnPreview:{tooltip:"Preview",action:"preview"},btnFullscreen:{tooltip:"Fullscreen",action:"fullscreen"},btnHelp:{tooltip:"Show markdown help",
action:"help"}},w={links:{label:"Links",help:"To use links in your markdown text you just have to  use <span> http://codeparl.com - automatic! <br> [a link](https://www.codeparl.com/) <br> Format: [text](url)</span>"},images:{label:"Images",help:"Images are exactly like links, but they have an exclamation mark before  them:<br><span> ![CodeParl logo](https://codeparl.com/storage/images/logo.png) <br> Format: ![Alt Text](url)</span>The word in square brackets is the alt text, which gets displayed if the browser can't show the image. "},
styling:{label:"Styling/Heading",help:"<span> *This is italicized*, and so <br> is _this_. <br> **This is bold**, just like __this__.<br>You can ***combine*** them if you ___really have to___.</span>To break your text into sections, you can use headers: <span>A Large Header<br>============== <br><br>Smaller Subheader<br>-----------------</span>Use hash marks if you need several levels of headers: <span># Header 1 #<br> ## Header 2 ##<br>### Header 3 ###</span> Use dashes if you need a horizontal rule <span>----------</span>"},
lists:{label:"Lists",help:"Both bulleted and numbered lists are possible:<span>- Use a minus sign for a bullet<br>+ Or plus sign<br>* Or an asterisk<br><br>1. Numbered lists are easy<br>2. Markdown keeps track ofthe numbers for you<br>7. So this will be item 3.<hr>1. Lists in a list item:<br> - Indented four spaces.<br> * indented eight spaces.<br>- Four spaces again.<br>2.  You can have multiple<br>  paragraphs in a list items. <br>Just be sure to indent."}},x={bold:{name:"bold",bindKey:{win:"Ctrl-B",
mac:"Command-B"},exec:function(){var a=c.session.getTextRange(c.getSelectionRange());0===a.trim().length?(l.insertSnippet(c,"**${1:text}**"),c.find("text")):l.insertSnippet(c,"**"+a+"**");c.focus()},readOnly:!1},italic:{name:"italic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(){var a=c.session.getTextRange(c.getSelectionRange());""===a?(l.insertSnippet(c,"*${1:text}*"),c.find("text")):l.insertSnippet(c,"*"+a+"*");c.focus()},readOnly:!1},link:{name:"link",bindKey:{win:"Ctrl-K",mac:"Command-K"},
exec:function(){var a=B({title:"Enter Url",body:C()}).modal("show");z(a,!0)},readOnly:!1}},y={init:function(a){g=d.extend(!0,{},d.fn.codeparlMarkdown.defaults,a);q=this;q.addClass("w-100");0<this.filter(function(){return d(this).data("codeparlMarkdown")}).length&&d.error("The plugin has already been initialized.");this.data("codeparlMarkdown",g);this.css({height:g.editor.editorHeight}).addClass("cpme-editor");k=this.parent();k.addClass("w-100 border cpmd-container ").css({backgroundColor:"#F7F7F4"});
a=H(g);a.prependTo(k);a.append(d("<div>").addClass("clearfix"));g.help.show&&I().insertAfter(a);n=d("<div>").addClass("cpme-preview w-100 markdown-body overflow-auto p-2 bg-white border").hide().appendTo(k).css({height:g.editor.editorHeight});K(g);G(g);return this},markdownContent:function(a){if(a)c.session.setValue(a),c.clearSelection();else return t(c.getValue())},htmlContent:function(){return u.makeHtml(t(c.session.getValue()))},preview:function(a,b){a&&(b=d.extend(!0,{},d.fn.codeparlMarkdown.defaults,
b),k=this.parent(),n=d("<div>").addClass("cpme-preview markdown-body overflow-auto p-2 bg-white border").appendTo(k).css({height:b.editorHeight,width:b.editorWidth}),0<a.trim().length&&(a=u.makeHtml(a||""),this.html(n.html(v(a)))))},destroy:function(){}};d.fn.codeparlMarkdown=function(a){if(y[a])return y[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==d.type(a)&&a)d.error("The method "+a+" does not exist on codeparlMarkdown");else return y.init.apply(this,arguments)};d.fn.codeparlMarkdown.defaults=
{fullscreen:!0,content:{allowScript:!1},help:{show:!0,link:{url:"https://www.markdownguide.org/basic-syntax/",text:"Advanced help"}},editor:{softTabs:!0,theme:"tomorrow",editorHeight:"500px",editorWidth:"100%",fontSize:16,showGutter:!1},toolbar:{bg:"#F7F7F4",buttonGroups:[{btnHeader1:"H1",btnHeader2:"H2"},{btnBold:"fa-bold",btnItalic:"fa-italic"},{btnList:"fa-list-ul",btnOrderedList:"fa-list-ol",btnRule:"line"},{btnBlock:"fa-quote-left",btnCode:"{ }"},{btnLink:"fa-link",btnImage:"fa-image"},{btnHelp:"fa-question-circle"},
{btnEdit:"fa-edit",btnbrowse:"fa-folder-open",btnPreview:"fa-eye",btnFullscreen:"fa-expand"}]},onFileBrowse:function(a,b){if(a[0].files[0]){var e=new FileReader;e.onload=function(f){b.session.setValue(f.target.result);b.clearSelection()};e.readAsText(a[0].files[0])}},onPreview:function(a,b){}}})(jQuery);